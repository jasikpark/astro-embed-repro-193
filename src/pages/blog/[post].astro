---
import type { GetStaticPaths } from "astro";
import { getCollection, type CollectionEntry } from "astro:content";

export async function getAllPublishablePosts() {
  const posts = await getCollection("posts", (post) => !!post.data.date && !post.data.hide);

  return posts.sort((a, b) => new Date(b.data.date).valueOf() - new Date(a.data.date).valueOf());
}

export const getStaticPaths: GetStaticPaths = async () => {
  const blogEntries = await getAllPublishablePosts();

  // generate paths for the blog posts
  return blogEntries.map((post) => ({
    params: { post: post.slug },
    props: { entry: post },
  }));
};

type Props = {
  entry: CollectionEntry<"posts">;
};

const { entry } = Astro.props;

const { Content } = await entry.render();
---

<Content />
